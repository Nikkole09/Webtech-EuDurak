import{a as F,b as C,c as G,d as T,g as H,h as $,i as N,k as A,m as D,q as z,s as B}from"./chunk-TYZA4MYZ.js";import{l as U,m as R}from"./chunk-DAQLCOVL.js";import{Aa as g,Bb as x,Ca as m,Da as l,G as L,J as v,M as d,N as u,Qa as s,Ra as _,Sa as O,Ta as M,aa as a,da as f,fa as I,ja as h,kb as k,lb as S,nb as P,ra as c,rb as V,sa as r,sb as j,ta as o,ua as w,yb as E}from"./chunk-ZKDIBBO6.js";var y=class i{constructor(t,e){this.http=t;this.auth=e}apiUrl="http://localhost:4000/lobbies";authHeaders(){let t=this.auth.getToken();return new V({Authorization:`Bearer ${t??""}`})}list(){return this.http.get(this.apiUrl)}create(t){return this.http.post(this.apiUrl,{name:t},{headers:this.authHeaders()})}join(t){return this.http.patch(`${this.apiUrl}/${t}/join`,{},{headers:this.authHeaders()})}leave(t){return this.http.patch(`${this.apiUrl}/${t}/leave`,{},{headers:this.authHeaders()})}start(t){return this.http.patch(`${this.apiUrl}/${t}/start`,{},{headers:this.authHeaders()})}remove(t){return this.http.delete(`${this.apiUrl}/${t}`,{headers:this.authHeaders()})}static \u0275fac=function(e){return new(e||i)(v(j),v(x))};static \u0275prov=L({token:i,factory:i.\u0275fac,providedIn:"root"})};function K(i,t){if(i&1){let e=g();r(0,"div",13)(1,"div"),s(2," Du bist in einem laufenden Spiel: "),r(3,"strong"),s(4),o()(),r(5,"button",14),m("click",function(){d(e);let b=l();return u(b.goToGame())}),s(6," Zum Spiel "),o()()}if(i&2){let e=l();a(4),_(e.myInGameLobby.name)}}function Q(i,t){if(i&1&&(r(0,"div",15),s(1),o()),i&2){let e=l();a(),_(e.error)}}function W(i,t){if(i&1){let e=g();r(0,"button",14),m("click",function(){d(e);let b=l().$implicit,p=l();return u(p.join(b._id))}),s(1," Beitreten "),o()}}function X(i,t){if(i&1){let e=g();r(0,"button",24),m("click",function(){d(e);let b=l().$implicit,p=l();return u(p.start(b._id))}),s(1," Start "),o()}}function tt(i,t){if(i&1){let e=g();r(0,"button",3),m("click",function(){d(e);let b=l().$implicit,p=l();return u(p.leave(b._id))}),s(1," Verlassen "),o()}}function et(i,t){if(i&1){let e=g();r(0,"button",3),m("click",function(){d(e);let b=l().$implicit,p=l();return u(p.remove(b._id))}),s(1," L\xF6schen "),o()}}function it(i,t){if(i&1&&(r(0,"div",16)(1,"div",17)(2,"div",18),s(3),o(),r(4,"div",19),s(5),o()(),r(6,"div",20),h(7,W,2,0,"button",21)(8,X,2,0,"button",22)(9,tt,2,0,"button",23)(10,et,2,0,"button",23),o()()),i&2){let e=t.$implicit,n=l();a(3),_(e.name),a(2),M(" Spieler: ",e.players.length," \u2013 Status: ",e.status," "),a(2),c("ngIf",!n.isMember(e)),a(),c("ngIf",n.isOwner(e)&&e.players.length>=2),a(),c("ngIf",n.isMember(e)),a(),c("ngIf",n.isOwner(e))}}var q=class i{constructor(t,e,n,b){this.lobby=t;this.fb=e;this.router=n;this.auth=b}allLobbies=[];openLobbies=[];myInGameLobby=null;form;loading=!1;error="";username="";myId=null;poll;ngOnInit(){let t=this.auth.getProfile();this.username=t?.username??"Gast",this.myId=t?.id??null,this.form=this.fb.group({name:this.fb.control("",{nonNullable:!0,validators:[C.required,C.minLength(2)]})}),this.refresh(),this.poll=setInterval(()=>this.refresh(),2e3)}ngOnDestroy(){this.poll&&clearInterval(this.poll)}get lobbies(){return this.openLobbies}isOwner(t){return!!this.myId&&t.ownerId===this.myId}isMember(t){return this.myId?!!t.players?.some(e=>e.userId===this.myId):!1}refresh(){this.loading=!0,this.error="",this.lobby.list().subscribe({next:t=>{this.loading=!1,this.allLobbies=t,this.myInGameLobby=this.allLobbies.find(e=>this.isMember(e)&&e.status==="in-game"&&!!e.currentGameId)??null,this.openLobbies=this.allLobbies.filter(e=>e.status==="open")},error:()=>{this.loading=!1,this.error="Lobbys konnten nicht geladen werden"}})}create(){if(this.form.invalid||this.loading)return;let t=this.form.controls.name.value;this.loading=!0,this.error="",this.lobby.create(t).subscribe({next:()=>{this.loading=!1,this.form.reset(),this.refresh()},error:()=>{this.loading=!1,this.error="Erstellen fehlgeschlagen"}})}join(t){this.lobby.join(t).subscribe({next:()=>this.refresh(),error:()=>this.error="Beitreten fehlgeschlagen"})}start(t){this.allLobbies.find(e=>e._id===t&&this.isOwner(e))&&this.lobby.start(t).subscribe({next:e=>this.router.navigate(["/game",e.gameId]),error:()=>this.error="Start fehlgeschlagen (Owner? \u2265 2 Spieler?)"})}leave(t){this.lobby.leave(t).subscribe({next:()=>this.refresh(),error:()=>this.error="Verlassen fehlgeschlagen"})}remove(t){this.lobby.remove(t).subscribe({next:()=>this.refresh(),error:()=>this.error="L\xF6schen fehlgeschlagen"})}goToGame(){this.myInGameLobby?.currentGameId&&this.router.navigate(["/game",this.myInGameLobby.currentGameId])}logout(){this.auth.logout(),this.router.navigateByUrl("/login")}static \u0275fac=function(e){return new(e||i)(f(y),f(A),f(E),f(x))};static \u0275cmp=I({type:i,selectors:[["app-lobbies"]],decls:17,vars:6,consts:[[1,"header-bar"],[1,"title"],[1,"welcome"],["mat-stroked-button","","color","warn",1,"pill",3,"click"],[1,"lobbies-container"],["class","banner",4,"ngIf"],[1,"create-row",3,"ngSubmit","formGroup"],[1,"lobby-input-bar"],["type","text","placeholder","Lobbyname","formControlName","name"],["mat-stroked-button","","color","primary","type","submit",1,"pill",3,"disabled"],["class","error",4,"ngIf"],[1,"lobby-list"],["class","lobby-card",4,"ngFor","ngForOf"],[1,"banner"],["mat-stroked-button","","color","primary",1,"pill",3,"click"],[1,"error"],[1,"lobby-card"],[1,"lobby-info"],[1,"lobby-title"],[1,"lobby-meta"],[1,"lobby-actions"],["mat-stroked-button","","class","pill","color","primary",3,"click",4,"ngIf"],["mat-stroked-button","","class","pill","color","accent",3,"click",4,"ngIf"],["mat-stroked-button","","class","pill","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","color","accent",1,"pill",3,"click"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1),s(2,"Europ\xE4ischer Durak"),o(),r(3,"div",2),s(4),o(),r(5,"button",3),m("click",function(){return n.logout()}),s(6,"Logout"),o()(),r(7,"div",4),h(8,K,7,1,"div",5),r(9,"form",6),m("ngSubmit",function(){return n.create()}),r(10,"div",7),w(11,"input",8),r(12,"button",9),s(13," Erstellen "),o()()(),h(14,Q,2,1,"div",10),r(15,"div",11),h(16,it,11,7,"div",12),o()()),e&2&&(a(4),O("Hallo ",n.username,", bereit zu gewinnen?"),a(4),c("ngIf",n.myInGameLobby),a(),c("formGroup",n.form),a(3),c("disabled",n.form.invalid||n.loading),a(2),c("ngIf",n.error),a(2),c("ngForOf",n.openLobbies))},dependencies:[P,k,S,D,H,F,G,T,$,N,R,U,z,B],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;background:url(/assets/Hintergrund.png) no-repeat center center fixed;background-size:cover;padding:0 20px 20px;box-sizing:border-box}.header-bar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:16px 32px;background:#a49ca8;margin:-2px -20px 20px;color:#fff}.header-bar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{justify-self:start;font-size:1.6rem;font-weight:700}.header-bar[_ngcontent-%COMP%]   .welcome[_ngcontent-%COMP%]{justify-self:center;font-size:1.1rem;font-weight:500;opacity:.95}.header-bar[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]{justify-self:end}.create-row[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:20px}.lobby-input-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px 20px;background:#f1f1f1;border-radius:9999px;border:2px solid #a49ca8;min-width:400px;max-width:600px}.lobby-input-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;outline:none;background:transparent;font-size:1rem;color:#333}.lobby-input-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:9999px!important;padding:6px 18px!important;font-weight:600;background-color:#a49ca8;color:#fff;border:none;cursor:pointer;transition:background .2s}.lobby-input-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#8e8792}.lobbies-container[_ngcontent-%COMP%]{margin:0 auto;max-width:1200px;width:100%}.error[_ngcontent-%COMP%]{color:#4a184f;font-weight:600;margin:8px 0 16px}.lobby-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.lobby-card[_ngcontent-%COMP%]{width:100%;padding:10px 16px;border:2px solid #a49ca8;border-radius:9999px;background:#f1f1f1;display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;min-height:52px;transition:box-shadow .15s ease,transform .15s ease}.lobby-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #00000026;transform:translateY(-1px)}.lobby-info[_ngcontent-%COMP%]{min-width:0}.lobby-info[_ngcontent-%COMP%]   .lobby-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.05rem}.lobby-info[_ngcontent-%COMP%]   .lobby-meta[_ngcontent-%COMP%]{font-size:.9rem;color:#333;opacity:.85}.lobby-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;align-items:center;min-width:400px}.pill[_ngcontent-%COMP%]{border-radius:9999px!important;padding:5px 12px!important;font-weight:600;text-transform:none;letter-spacing:.2px;background-color:#a49ca8!important;color:#fff!important;border:none!important;transition:background .2s}.pill[_ngcontent-%COMP%]:hover{background-color:#8e8792!important}@media (max-width: 900px){.lobby-card[_ngcontent-%COMP%]{grid-template-columns:1fr;row-gap:8px}.lobby-actions[_ngcontent-%COMP%]{justify-content:flex-start;min-width:0}}"]})};export{q as LobbiesComponent};
