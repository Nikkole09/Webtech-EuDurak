import{a as K,b as U}from"./chunk-COKB4VV7.js";import{k as N,m as L}from"./chunk-DAQLCOVL.js";import{$ as R,Aa as C,Bb as M,Ca as g,Da as p,G as H,J as T,M as f,N as h,Na as k,Qa as l,Ra as x,Sa as b,Ta as A,Ya as S,aa as c,da as v,fa as I,ja as s,jb as F,ka as $,kb as V,lb as z,nb as P,p as G,ra as r,sa as o,sb as B,ta as a,ua as _,wb as D,ya as y,yb as j,za as O}from"./chunk-ZKDIBBO6.js";var w=class n{card;back=!1;selectable=!1;selected=!1;cardClick=new $;normalizeIdForAsset(t){let e=/^(\d+)([CDHS])$/i.exec(t);if(!e)return t;let i=parseInt(e[1],10),d=e[2].toUpperCase();return i>=2&&i<=10?`${i}${d}`:`${i===11?"J":i===12?"Q":i===13?"K":i===14?"A":String(i)}${d}`}get src(){return this.back?"/assets/cards/back.png":this.card?.id?`/assets/cards/${this.normalizeIdForAsset(this.card.id.toUpperCase())}.png`:"/assets/cards/placeholder.png"}get classes(){return{card:!0,"is-selectable":this.selectable,"is-selected":this.selected}}onClick(){this.selectable&&this.cardClick.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-card"]],inputs:{card:"card",back:"back",selectable:"selectable",selected:"selected"},outputs:{cardClick:"cardClick"},decls:1,vars:2,consts:[["alt","card",3,"click","src","ngClass"]],template:function(e,i){e&1&&(o(0,"img",0),g("click",function(){return i.onClick()}),a()),e&2&&r("src",i.src,R)("ngClass",i.classes)},dependencies:[P,F],styles:[".card[_ngcontent-%COMP%]{display:inline-block;width:72px;-webkit-user-select:none;user-select:none;transition:transform .12s ease,box-shadow .12s ease,outline-color .12s ease;border-radius:8px}.is-selectable[_ngcontent-%COMP%]{cursor:pointer}.is-selected[_ngcontent-%COMP%]{transform:translateY(-4px);box-shadow:0 6px 18px #00000040;outline:3px solid #a49ca8;outline-offset:2px}"]})};var E=class n{constructor(t,e){this.http=t;this.auth=e}bodyOpts(){return{headers:this.auth.authHeaders().headers,observe:"body"}}getGame(t){return this.http.get("${API_BASE}/games/${id}",this.bodyOpts())}play(t,e){return this.http.post("${API_BASE}/games/${gameId}/play",e,this.bodyOpts())}takeStack(t){return this.http.post("${API_BASE}/games/${gameId}/take",{},this.bodyOpts())}revealHidden(t,e){return this.http.post("${API_BASE}/games/${gameId}/reveal-hidden",{index:e},this.bodyOpts())}static \u0275fac=function(e){return new(e||n)(T(B),T(M))};static \u0275prov=H({token:n,factory:n.\u0275fac,providedIn:"root"})};function X(n,t){n&1&&(o(0,"span",34),l(1," (hat die Runde erfolgreich beendet)"),a())}function ee(n,t){n&1&&_(0,"app-card",37),n&2&&r("back",!0)}function te(n,t){n&1&&_(0,"app-card",41),n&2&&r("back",!0)}function ne(n,t){if(n&1&&_(0,"app-card",42),n&2){let e=p().$implicit,i=p().ngIf;r("card",i.open[e])}}function ie(n,t){if(n&1&&(o(0,"div",38),s(1,te,1,1,"app-card",39)(2,ne,1,1,"app-card",40),a()),n&2){let e=t.$implicit,i=p().ngIf;c(),r("ngIf",e<i.counts.hidden),c(),r("ngIf",e<i.open.length)}}function re(n,t){if(n&1&&(y(0),o(1,"div",35),s(2,ee,1,1,"app-card",36),a(),o(3,"div",15),s(4,ie,3,2,"div",16),a(),O()),n&2){let e=t.ngIf,i=p(2);c(2),r("ngForOf",i.range(e.counts.hand)),c(2),r("ngForOf",i.range(3))}}function ae(n,t){n&1&&(o(0,"div",43),l(1,"frei \u2026"),a())}function oe(n,t){n&1&&(o(0,"span",34),l(1," (hat die Runde erfolgreich beendet)"),a())}function ce(n,t){n&1&&_(0,"app-card",37),n&2&&r("back",!0)}function pe(n,t){n&1&&_(0,"app-card",41),n&2&&r("back",!0)}function de(n,t){if(n&1&&_(0,"app-card",42),n&2){let e=p().$implicit,i=p().ngIf;r("card",i.open[e])}}function se(n,t){if(n&1&&(o(0,"div",38),s(1,pe,1,1,"app-card",39)(2,de,1,1,"app-card",40),a()),n&2){let e=t.$implicit,i=p().ngIf;c(),r("ngIf",e<i.counts.hidden),c(),r("ngIf",e<i.open.length)}}function le(n,t){if(n&1&&(y(0),o(1,"div",44),s(2,ce,1,1,"app-card",36),a(),o(3,"div",45),s(4,se,3,2,"div",16),a(),O()),n&2){let e=t.ngIf,i=p(2);c(2),r("ngForOf",i.range(e.counts.hand)),c(2),r("ngForOf",i.range(3))}}function me(n,t){n&1&&(o(0,"div",43),l(1,"frei \u2026"),a())}function _e(n,t){n&1&&(o(0,"span",34),l(1," (hat die Runde erfolgreich beendet)"),a())}function ge(n,t){if(n&1){let e=C();o(0,"app-card",46),g("cardClick",function(){let d=f(e).$implicit,u=p(2);return h(u.toggleHand(d))}),a()}if(n&2){let e=t.$implicit,i=p(2);r("card",e)("selectable",!0)("selected",i.selectedHandIds.has(e.id))}}function ue(n,t){if(n&1){let e=C();o(0,"app-card",49),g("cardClick",function(){f(e);let d=p().$implicit,u=p(2);return h(u.flipHidden(d))}),a()}if(n&2){let e=p().$implicit,i=p().ngIf,d=p();r("back",d.previewHiddenIndex!==e)("card",i.you.hidden[e])("selectable",i.phaseForYou==="hidden")("selected",d.previewHiddenIndex===e)}}function fe(n,t){if(n&1){let e=C();o(0,"app-card",50),g("cardClick",function(){f(e);let d=p().$implicit,u=p(2);return h(u.toggleOpen(d))}),a()}if(n&2){let e=p().$implicit,i=p().ngIf,d=p();r("card",i.you.open[e])("selectable",!0)("selected",d.selectedOpenIdxs.has(e))}}function he(n,t){if(n&1&&(o(0,"div",38),s(1,ue,1,4,"app-card",47)(2,fe,1,3,"app-card",48),a()),n&2){let e=t.$implicit,i=p().ngIf;c(),r("ngIf",e<i.you.hidden.length),c(),r("ngIf",e<i.you.open.length)}}function xe(n,t){n&1&&(o(0,"span",34),l(1," (hat die Runde erfolgreich beendet)"),a())}function ve(n,t){n&1&&_(0,"app-card",37),n&2&&r("back",!0)}function Ce(n,t){n&1&&_(0,"app-card",41),n&2&&r("back",!0)}function be(n,t){if(n&1&&_(0,"app-card",42),n&2){let e=p().$implicit,i=p().ngIf;r("card",i.open[e])}}function Ie(n,t){if(n&1&&(o(0,"div",38),s(1,Ce,1,1,"app-card",39)(2,be,1,1,"app-card",40),a()),n&2){let e=t.$implicit,i=p().ngIf;c(),r("ngIf",e<i.counts.hidden),c(),r("ngIf",e<i.open.length)}}function ye(n,t){if(n&1&&(y(0),o(1,"div",44),s(2,ve,1,1,"app-card",36),a(),o(3,"div",45),s(4,Ie,3,2,"div",16),a(),O()),n&2){let e=t.ngIf,i=p(2);c(2),r("ngForOf",i.range(e.counts.hand)),c(2),r("ngForOf",i.range(3))}}function Oe(n,t){n&1&&(o(0,"div",43),l(1,"frei \u2026"),a())}function ke(n,t){if(n&1&&(o(0,"span",51),l(1),a()),n&2){let e=p().ngIf;c(),x(e.lastEventMessage)}}function Se(n,t){if(n&1){let e=C();o(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8),l(4),s(5,X,2,0,"span",9),a(),s(6,re,5,2,"ng-container",10)(7,ae,2,0,"ng-template",null,0,S),a()(),o(9,"div",11)(10,"div",7)(11,"div",8),l(12),s(13,oe,2,0,"span",9),a(),s(14,le,5,2,"ng-container",10)(15,me,2,0,"ng-template",null,1,S),a()(),o(17,"div",12)(18,"div",7)(19,"div",8),l(20),s(21,_e,2,0,"span",9),a(),o(22,"div",13),s(23,ge,1,3,"app-card",14),a(),o(24,"div",15),s(25,he,3,2,"div",16),a()()(),o(26,"div",17)(27,"div",7)(28,"div",8),l(29),s(30,xe,2,0,"span",9),a(),s(31,ye,5,2,"ng-container",10)(32,Oe,2,0,"ng-template",null,2,S),a()(),o(34,"div",18)(35,"div",19)(36,"div",20)(37,"div",21)(38,"div",22),_(39,"app-card",23),a()(),o(40,"div",24)(41,"div",25),l(42),a()()(),o(43,"div",20)(44,"div",21)(45,"div",26),_(46,"app-card",27),a()(),o(47,"div",24)(48,"div"),l(49),a()()(),o(50,"div",20)(51,"div",21)(52,"div",22),_(53,"app-card",23),a()(),o(54,"div",24)(55,"div",25),l(56),a()()(),o(57,"div",28),l(58),o(59,"button",29),g("click",function(){f(e);let d=p();return h(d.refresh())}),o(60,"mat-icon"),l(61,"refresh"),a()(),s(62,ke,2,1,"span",30),a()(),o(63,"div",31)(64,"button",32),g("click",function(){f(e);let d=p();return h(d.take())}),l(65,"Stapel nehmen"),a(),o(66,"button",33),g("click",function(){f(e);let d=p();return h(d.playSelectedCombined())}),l(67," Karten legen "),a(),o(68,"button",33),g("click",function(){f(e);let d=p();return h(d.confirmPlayHidden())}),l(69," Verdeckt legen "),a()()()()}if(n&2){let e=t.ngIf,i=k(8),d=k(16),u=k(33),m=p();c(4),b(" ",(m.oppTopLeft==null?null:m.oppTopLeft.username)||"Spieler 3"," "),c(),r("ngIf",m.oppTopLeft==null?null:m.oppTopLeft.finished),c(),r("ngIf",m.oppTopLeft)("ngIfElse",i),c(6),b(" ",(m.oppTopRight==null?null:m.oppTopRight.username)||"Spieler 2"," "),c(),r("ngIf",m.oppTopRight==null?null:m.oppTopRight.finished),c(),r("ngIf",m.oppTopRight)("ngIfElse",d),c(6),b(" ",e.you.username||"Du"," "),c(),r("ngIf",e.you.finished),c(2),r("ngForOf",e.you.hand),c(2),r("ngForOf",m.range(3)),c(4),b(" ",(m.oppBottomRight==null?null:m.oppBottomRight.username)||"Spieler 4"," "),c(),r("ngIf",m.oppBottomRight==null?null:m.oppBottomRight.finished),c(),r("ngIf",m.oppBottomRight)("ngIfElse",u),c(8),r("back",!0),c(3),x(e.drawCount),c(4),r("card",e.discardTop||void 0),c(3),x(e.discardTop?"":"Noch keine Karte gelegt"),c(4),r("back",!0),c(3),x(e.burnedCount),c(2),A(" Am Zug: ",e.currentTurnUsername||m.currentTurnName()," \xB7 Deine Phase: ",e.phaseForYou," "),c(4),r("ngIf",e.lastEventMessage),c(4),r("disabled",m.selectedHandIds.size===0&&m.selectedOpenIdxs.size===0),c(2),r("disabled",m.previewHiddenIndex===null)}}function Pe(n,t){if(n&1&&(o(0,"div",52),l(1),a()),n&2){let e=p();c(),x(e.error)}}var Z=class n{constructor(t,e,i,d){this.route=t;this.router=e;this.game=i;this.auth=d}gameId;state=null;oppTopLeft=null;oppTopRight=null;oppBottomRight=null;selectedHandIds=new Set;selectedOpenIdxs=new Set;previewHiddenIndex=null;error="";sub;pollSub;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(!t){this.router.navigateByUrl("/lobbies");return}this.gameId=t,this.refresh(),this.pollSub=G(2e3).subscribe(()=>this.refresh())}ngOnDestroy(){this.sub?.unsubscribe(),this.pollSub?.unsubscribe()}refresh(t=this.gameId){this.error="",this.sub?.unsubscribe(),this.sub=this.game.getGame(t).subscribe({next:e=>{this.state=e,this.mapOpponents(e),this.syncSelection()},error:e=>{this.error=e?.error?.error??"Konnte Spielzustand nicht laden"}})}mapOpponents(t){this.oppTopLeft=null,this.oppTopRight=null,this.oppBottomRight=null,t.others&&t.others.length&&(this.oppTopRight=t.others[0]??null,this.oppTopLeft=t.others[1]??null,this.oppBottomRight=t.others[2]??null)}currentTurnName(){return this.state?.currentTurnUsername??(this.state?.turnIndex===0?this.state?.you.username||"Du":this.state?.others[this.state.turnIndex-1]?.username||`Spieler #${this.state?.turnIndex}`)}toggleHand(t){t?.id&&(this.selectedOpenIdxs.size>0&&this.selectedOpenIdxs.clear(),this.selectedHandIds.has(t.id)?this.selectedHandIds.delete(t.id):this.selectedHandIds.add(t.id))}toggleOpen(t){this.selectedHandIds.size>0&&this.selectedHandIds.clear(),this.selectedOpenIdxs.has(t)?this.selectedOpenIdxs.delete(t):this.selectedOpenIdxs.add(t)}playSelectedCombined(){if(this.state){if(this.selectedHandIds.size>0){let t=Array.from(this.selectedHandIds);this.game.play(this.gameId,{source:"hand",cardIds:t}).subscribe({next:e=>{this.state=e,this.mapOpponents(e),this.selectedHandIds.clear(),this.previewHiddenIndex=null},error:e=>{this.error=e?.error?.error??"Zug nicht m\xF6glich"}});return}if(this.selectedOpenIdxs.size>0){let t=[];for(let e of this.selectedOpenIdxs){let i=this.state.you.open[e];i?.id&&t.push(i.id)}if(t.length===0)return;this.game.play(this.gameId,{source:"open",cardIds:t}).subscribe({next:e=>{this.state=e,this.mapOpponents(e),this.selectedOpenIdxs.clear(),this.previewHiddenIndex=null},error:e=>{this.error=e?.error?.error??"Zug nicht m\xF6glich"}});return}}}flipHidden(t){this.state&&this.state.phaseForYou==="hidden"&&this.previewHiddenIndex===null&&(t<0||t>=this.state.you.hidden.length||this.game.revealHidden(this.gameId,t).subscribe({next:e=>{this.state=e,this.mapOpponents(e),this.previewHiddenIndex=t,this.selectedHandIds.clear(),this.selectedOpenIdxs.clear()},error:e=>{this.error=e?.error?.error??"Konnte verdeckte Karte nicht aufdecken"}}))}confirmPlayHidden(){this.state&&this.previewHiddenIndex!==null&&this.game.play(this.gameId,{source:"hidden"}).subscribe({next:t=>{this.state=t,this.mapOpponents(t),this.previewHiddenIndex=null},error:t=>{this.error=t?.error?.error??"Zug nicht m\xF6glich"}})}take(){this.game.takeStack(this.gameId).subscribe({next:t=>{this.state=t,this.mapOpponents(t),this.selectedHandIds.clear(),this.selectedOpenIdxs.clear(),this.previewHiddenIndex=null},error:t=>{this.error=t?.error?.error??"Konnte Stapel nicht nehmen"}})}syncSelection(){if(!this.state)return;let t=new Set(this.state.you.hand.map(i=>i.id));for(let i of Array.from(this.selectedHandIds))t.has(i)||this.selectedHandIds.delete(i);let e=this.state.you.open.length;for(let i of Array.from(this.selectedOpenIdxs))(i<0||i>=e)&&this.selectedOpenIdxs.delete(i);this.previewHiddenIndex!==null&&this.previewHiddenIndex>=this.state.you.hidden.length&&(this.previewHiddenIndex=null)}range(t){let e=Math.max(0,Math.floor(t||0));return Array.from({length:e},(i,d)=>d)}static \u0275fac=function(e){return new(e||n)(v(D),v(j),v(E),v(M))};static \u0275cmp=I({type:n,selectors:[["app-game"]],decls:2,vars:2,consts:[["tlEmpty",""],["trEmpty",""],["brEmpty",""],["class","table-grid",4,"ngIf"],["class","error",4,"ngIf"],[1,"table-grid"],[1,"cell","tl"],[1,"player-field"],[1,"seat-title"],["class","muted",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"cell","tr"],[1,"cell","bl"],[1,"hand"],["class","card-sm",3,"card","selectable","selected","cardClick",4,"ngFor","ngForOf"],[1,"stacks"],["class","stack",4,"ngFor","ngForOf"],[1,"cell","br"],[1,"cell","center"],[1,"center-panel"],[1,"center-row"],[1,"card-col"],[1,"card-wrap","rot90"],[1,"card-md",3,"back"],[1,"right-col"],[1,"count"],[1,"card-wrap"],[1,"card-md",3,"card"],[1,"status","muted"],["mat-icon-button","","color","primary",1,"ml8",3,"click"],["class","ml8",4,"ngIf"],[1,"take-row"],[1,"pill","btn-take",3,"click"],[1,"pill","btn-take",3,"click","disabled"],[1,"muted"],[1,"hand","hand-opponent"],["class","card-sm",3,"back",4,"ngFor","ngForOf"],[1,"card-sm",3,"back"],[1,"stack"],["class","phase3",3,"back",4,"ngIf"],["class","phase2",3,"card",4,"ngIf"],[1,"phase3",3,"back"],[1,"phase2",3,"card"],[1,"seat-empty","muted"],[1,"hand","hand-opponent","right"],[1,"stacks","right"],[1,"card-sm",3,"cardClick","card","selectable","selected"],["class","phase3",3,"back","card","selectable","selected","cardClick",4,"ngIf"],["class","phase2",3,"card","selectable","selected","cardClick",4,"ngIf"],[1,"phase3",3,"cardClick","back","card","selectable","selected"],[1,"phase2",3,"cardClick","card","selectable","selected"],[1,"ml8"],[1,"error"]],template:function(e,i){e&1&&s(0,Se,70,27,"div",3)(1,Pe,2,1,"div",4),e&2&&(r("ngIf",i.state),c(),r("ngIf",i.error))},dependencies:[P,V,z,L,N,U,K,w],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;min-height:100vh;background:url(/assets/Hintergrund.png) no-repeat center center fixed;background-size:cover}.table-grid[_ngcontent-%COMP%]{height:calc(100vh - 8px);width:99vw;display:grid;grid-template-areas:"tl center tr" "bl center br";grid-template-columns:1fr .8fr 1fr;grid-template-rows:.92fr .92fr;gap:20px;padding:12px;box-sizing:border-box;overflow:hidden}.cell[_ngcontent-%COMP%]{min-height:0}.cell.tl[_ngcontent-%COMP%]{grid-area:tl}.cell.tr[_ngcontent-%COMP%]{grid-area:tr}.cell.bl[_ngcontent-%COMP%]{grid-area:bl}.cell.br[_ngcontent-%COMP%]{grid-area:br}.cell.center[_ngcontent-%COMP%]{grid-area:center;display:flex;flex-direction:column;align-items:center;justify-content:flex-start}.player-field[_ngcontent-%COMP%], .center-panel[_ngcontent-%COMP%]{background:#f5edef;border:2px solid #a49ca8;border-radius:16px;box-shadow:0 1px 6px #00000014}.player-field[_ngcontent-%COMP%]{height:calc(100% - 20px);padding:10px 12px;display:flex;flex-direction:column;gap:10px}.seat-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:2px}.seat-empty[_ngcontent-%COMP%]{padding:10px 6px;font-style:italic}.muted[_ngcontent-%COMP%]{opacity:.75}.right[_ngcontent-%COMP%]{align-items:flex-end;text-align:right}app-card.card-sm[_ngcontent-%COMP%]{width:82px;display:inline-block}.center-panel[_ngcontent-%COMP%]   app-card.card-md[_ngcontent-%COMP%]{width:106px;display:inline-block}.hand[_ngcontent-%COMP%], .hand-opponent[_ngcontent-%COMP%]{display:flex;align-items:center;gap:0;max-width:100%;overflow:hidden}.hand[_ngcontent-%COMP%]   app-card.card-sm[_ngcontent-%COMP%] + app-card.card-sm[_ngcontent-%COMP%], .hand-opponent[_ngcontent-%COMP%]   app-card.card-sm[_ngcontent-%COMP%] + app-card.card-sm[_ngcontent-%COMP%]{margin-left:-50px}.stacks[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-evenly;width:100%;margin-top:33px;box-sizing:border-box;gap:50px;min-width:260px}.stack[_ngcontent-%COMP%]{position:relative;width:72px;height:100px}.stack[_ngcontent-%COMP%]   .phase3[_ngcontent-%COMP%], .stack[_ngcontent-%COMP%]   .phase2[_ngcontent-%COMP%]{position:absolute;top:0;left:0;display:grid;place-items:center}.stack[_ngcontent-%COMP%]   .phase3[_ngcontent-%COMP%]{z-index:1}.stack[_ngcontent-%COMP%]   .phase2[_ngcontent-%COMP%]{z-index:2;transform:translateY(-2px)}.center-panel[_ngcontent-%COMP%]{width:min(520px,95%);padding:12px;display:flex;flex-direction:column;gap:14px;align-items:stretch;margin-top:145px}.center-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:150px 1fr;align-items:center;column-gap:16px;min-height:114px}.card-col[_ngcontent-%COMP%]{display:grid;place-items:center}.right-col[_ngcontent-%COMP%]{display:flex;align-items:center}.card-wrap[_ngcontent-%COMP%]{display:grid;place-items:center}.rot90[_ngcontent-%COMP%]{transform:rotate(90deg)}.count[_ngcontent-%COMP%]{font-weight:800;font-size:1rem}.status[_ngcontent-%COMP%]{text-align:center;margin-top:4px}.ml8[_ngcontent-%COMP%]{margin-left:8px}.take-row[_ngcontent-%COMP%]{margin-top:8px;display:flex;justify-content:center;gap:12px}.pill.btn-take[_ngcontent-%COMP%]{border-radius:9999px;padding:6px 16px;font-weight:600;border:2px solid #a49ca8;background:#fff;color:#a49ca8;cursor:pointer;transition:background .2s,color .2s,transform .12s ease}.pill.btn-take[_ngcontent-%COMP%]:hover{background:#a49ca8;color:#fff;transform:translateY(-1px)}@media (max-width: 1200px){app-card.card-sm[_ngcontent-%COMP%]{width:66px}.stack[_ngcontent-%COMP%]{width:66px;height:92px}.stacks[_ngcontent-%COMP%]{padding:0 16px;min-width:230px}.center-panel[_ngcontent-%COMP%]   app-card.card-md[_ngcontent-%COMP%]{width:90px}.table-grid[_ngcontent-%COMP%]{gap:18px;padding:10px}}']})};export{Z as GameComponent};
